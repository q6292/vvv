local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- Create GUI with proper parenting and cleanup
local gui = Instance.new("ScreenGui")
gui.Name = "KeyAccessGUI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = CoreGui

-- Main Frame with optimized properties
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 220) -- Slightly taller for better spacing
frame.Position = UDim2.new(0.5, -175, 0.5, -110)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.AnchorPoint = Vector2.new(0.5, 0.5) -- Center anchor for smoother positioning
frame.Parent = gui
frame.Active = true
frame.Draggable = true

-- Corner
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

-- Add subtle drop shadow
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.Image = "rbxassetid://1316045217"
shadow.ImageColor3 = Color3.new(0, 0, 0)
shadow.ImageTransparency = 0.8
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.Size = UDim2.new(1, 20, 1, 20)
shadow.Position = UDim2.new(0, -10, 0, -10)
shadow.BackgroundTransparency = 1
shadow.Parent = frame
shadow.ZIndex = -1

-- Title with gradient
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 0, 40)
title.Position = UDim2.new(0, 20, 0, 10)
title.BackgroundTransparency = 1
title.Text = "ðŸ”‘ Key Access System"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

-- Divider line
local divider = Instance.new("Frame")
divider.Size = UDim2.new(1, -40, 0, 1)
divider.Position = UDim2.new(0, 20, 0, 50)
divider.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
divider.BorderSizePixel = 0
divider.Parent = frame

-- Description with better formatting
local desc = Instance.new("TextLabel")
desc.Size = UDim2.new(1, -40, 0, 60)
desc.Position = UDim2.new(0, 20, 0, 60)
desc.BackgroundTransparency = 1
desc.Text = "Join our Discord server to receive your exclusive access key and unlock premium features!"
desc.TextColor3 = Color3.fromRGB(200, 200, 200)
desc.Font = Enum.Font.Gotham
desc.TextSize = 14
desc.TextWrapped = true
desc.TextXAlignment = Enum.TextXAlignment.Center
desc.Parent = frame

-- Button container for better organization
local buttonContainer = Instance.new("Frame")
buttonContainer.Size = UDim2.new(1, -40, 0, 40)
buttonContainer.Position = UDim2.new(0, 20, 1, -60)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = frame

local buttonLayout = Instance.new("UIListLayout")
buttonLayout.FillDirection = Enum.FillDirection.Horizontal
buttonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
buttonLayout.SortOrder = Enum.SortOrder.LayoutOrder
buttonLayout.Padding = UDim.new(0, 10)
buttonLayout.Parent = buttonContainer

-- Copy Invite Button with hover effects
local copyBtn = Instance.new("TextButton")
copyBtn.Size = UDim2.new(0.5, -5, 1, 0)
copyBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242) -- Discord brand color
copyBtn.Text = "ðŸ“‹ Copy Invite"
copyBtn.Font = Enum.Font.GothamBold
copyBtn.TextColor3 = Color3.new(1, 1, 1)
copyBtn.TextSize = 14
copyBtn.LayoutOrder = 1
copyBtn.AutoButtonColor = false
copyBtn.Parent = buttonContainer

local copyCorner = Instance.new("UICorner")
copyCorner.CornerRadius = UDim.new(0, 8)
copyCorner.Parent = copyBtn

-- Joined Button with hover effects
local joinBtn = Instance.new("TextButton")
joinBtn.Size = UDim2.new(0.5, -5, 1, 0)
joinBtn.BackgroundColor3 = Color3.fromRGB(87, 242, 135)
joinBtn.Text = "âœ… I've Joined"
joinBtn.Font = Enum.Font.GothamBold
joinBtn.TextColor3 = Color3.new(1, 1, 1)
joinBtn.TextSize = 14
joinBtn.LayoutOrder = 2
joinBtn.AutoButtonColor = false
joinBtn.Parent = buttonContainer

local joinCorner = Instance.new("UICorner")
joinCorner.CornerRadius = UDim.new(0, 8)
joinCorner.Parent = joinBtn

-- Button hover effects
local function buttonHoverEffect(button, hoverColor, originalColor)
    local tweenService = game:GetService("TweenService")
    
    button.MouseEnter:Connect(function()
        local tween = tweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor})
        tween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local tween = tweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = originalColor})
        tween:Play()
    end)
end

buttonHoverEffect(copyBtn, Color3.fromRGB(71, 82, 196), Color3.fromRGB(88, 101, 242))
buttonHoverEffect(joinBtn, Color3.fromRGB(69, 196, 107), Color3.fromRGB(87, 242, 135))

-- Close button (optional)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 24, 0, 24)
closeBtn.Position = UDim2.new(1, -32, 0, 10)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "Ã—"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
closeBtn.TextSize = 24
closeBtn.Parent = frame

-- Function to clean up
local function destroyGUI()
    gui:Destroy()
end

-- Button functionality
local DISCORD_INVITE = "https://discord.gg/NMwq5ghcsF" -- Replace with your invite

copyBtn.MouseButton1Click:Connect(function()
    setclipboard(DISCORD_INVITE)
    
    -- Show confirmation
    local originalText = copyBtn.Text
    copyBtn.Text = "Copied!"
    
    task.delay(1.5, function()
        if copyBtn then
            copyBtn.Text = originalText
        end
    end)
end)

joinBtn.MouseButton1Click:Connect(function()
    destroyGUI()
    -- Proceed to key verification system
    -- You would typically open another GUI here for key input
end)

closeBtn.MouseButton1Click:Connect(destroyGUI)

-- Make frame draggable with better UX
local dragging
local dragInput
local dragStart
local startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateInput(input)
    end
end)
